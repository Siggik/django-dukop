{% extends "base.html" %}
{% load i18n sekizai_tags static %}

{% block dukop_title %}{% trans "Update event" %} - {{ event.name }}{% endblock %}

{% block content %}

<div class="create-event">
  {% if forms_had_errors %}
  <div class="message message__error">
    {% trans "There were errors. Please check below. If you submitted images, you have to re-select them." %}
  </div>
  {% endif %}
  <h1 class="card__title">{% trans "Update:" %} {{ event.name }}</h1>

    <form action="" method="POST" class="event__form" enctype="multipart/form-data">
      {% csrf_token %}
      <h2>{% trans "Basic details" %}</h2>
      <table>

        {% for field in form %}
        <tr class="{{ field.name }}">
          <th>
            {{ field.label_tag}}
          </th>
          <td>
            {{ field }}
            {% if field.help_text %}{{ field.help_text }}{% endif %}
          </td>
        </tr>
        {% endfor %}

      </table>
      <h2>{% trans "Date and times" %}</h2>
      <p>
        {% trans "Most events just had a single start and finish time. But if your event spans several days, you can add additional start and finish times." %}
        {% trans "If this event recurs on a regular basis, you can indicate this further down this page." %}
      </p>
      {{ times.management_form }}
      {% if times.non_form_errors %}
      <div class="message message__error">
        {{ times.non_form_errors }}
      </div>
      {% endif %}
      <table>
        {% for time in times %}
        <tr class="formset--element {% if not time.errors and not forloop.first %}hide{% endif %}">
          <th>{% trans "Time slot" %} {{ forloop.counter }}:</th>
          <td>
            {{ time.id }}
            <div>
                <div>
                    {{ time.start.label_tag }} *Required<br>
                    {{ time.start }}
                </div>
                {% if time.start.errors %}
                    {{ time.start.errors }}
                {% endif %}
                <div>
                    {{ time.end.label_tag }}<br>
                    {{ time.end }}
                </div>
                {% if time.end.errors %}
                    {{ time.end.errors }}
                {% endif %}
                {% if not forloop.last %}
                <div class="formset-add-remove-buttons">
                <button type="button" class="formset-add-link">
                    {% trans "Add one more..." %}
                </button>
                {% endif %}
                {% if not forloop.first %}
                <button type="button" class="formset-remove-link">
                    {% trans "Remove timeslot" %}
                </button>
                </div>
                {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}

      </table>

      <h2>{% trans "Automatic recurrence" %}</h2>
      <p>
        {% trans "If you want your event to recur automatically with an interval, you can set it here instead of adding individual timeslots manually." %}
      </p>
      {{ recurrences.management_form }}
      {% if recurrences.non_form_errors %}
      <div class="message message__error">
        {{ recurrences.non_form_errors }}
      </div>
      {% endif %}
      <table>
        {% for recurrence in recurrences %}
        <tr class="formset--element {% if not recurrence.errors and not forloop.first %}hide{% endif %}">
          <th>{% trans "Interval" %} {{ forloop.counter }}:</th>
          <td>
            {{ recurrence.id }}
            <div>
                <div>
                {{ recurrence.interval_type.label_tag }}<br>
                {{ recurrence.interval_type }}
                </div>
                {% if recurrence.interval_type.errors %}
                    {{ recurrence.interval_type.errors }}
                {% endif %}

                <div>
                {{ recurrence.end.label_tag }}<br>
                {{ recurrence.end }}
                </div>
                {% if recurrence.end.errors %}
                    {{ recurrence.end.errors }}
                {% endif %}

                {% if not forloop.last %}
                <div class="formset-add-remove-buttons">
                <button type="button" class="formset-add-link">
                    {% trans "Add one more..." %}
                </button>
                {% endif %}
                {% if not forloop.first %}
                <button type="button" class="formset-remove-link">
                    {% trans "Remove recurrence" %}
                </button>
                </div>
                {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}

      </table>
      <h2>{% trans "Images" %}</h2>
      <p>
        {% trans "We really recommend that you add an illustration. Don't let your Facebook event look better than your Duk Op event!" %}
      </p>
      {{ images.management_form }}
      {% if images.non_form_errors %}
      <div class="message message__error">
        {{ images.non_form_errors }}
      </div>
      {% endif %}
      <table>
        {% for image in images %}
        <tr class="formset--element {% if not image.errors and not forloop.first %}hide{% endif %}">
          <th>{% trans "Image" %} {{ forloop.counter }}:</th>
          <td>
            {{ image.id }}
            <div>
                <div>
                    {{ image.image }}
                </div>
                {% if image.image.errors %}
                    {{ image.image.errors }}
                {% endif %}
                <div>
                    {{ image.is_cover.label_tag }}
                    {{ image.is_cover }}
                </div>
                {% if image.is_cover.errors %}
                    {{ image.is_cover.errors }}
                {% endif %}

                {% if not forloop.last %}
                <div class="formset-add-remove-buttons">
                <button type="button" class="formset-add-link">
                    {% trans "Add one more..." %}
                </button>
                {% endif %}
                {% if not forloop.first %}
                <button type="button" class="formset-remove-link">
                    {% trans "Remove image" %}
                </button>
                </div>
                {% endif %}

            </div>
          </td>
        </tr>
        {% endfor %}

      </table>

      <h2>{% trans "Links" %}</h2>
      <p>
        {% trans "We really recommend that you add an illustration. Don't let your Facebook event look better than your Duk Op event!" %}
      </p>
      {{ links.management_form }}
      {% if links.non_form_errors %}
      <div class="message message__error">
        {{ links.non_form_errors }}
      </div>
      {% endif %}
      <table>
        {% for link in links %}
        <tr class="formset--element {% if not link.errors and not forloop.first %}hide{% endif %}">
          <th>{% trans "Link" %} {{ forloop.counter }}:</th>
          <td>
            {{ link.id }}
            <div>
                <div>{{ link.link }}</div>
                {% if link.link.errors %}
                    {{ link.link.errors }}
                {% endif %}

                {% if not forloop.last %}
                <div class="formset-add-remove-buttons">
                <button type="button" class="formset-add-link">
                    {% trans "Add one more..." %}
                </button>
                {% endif %}
                {% if not forloop.first %}
                <button type="button" class="formset-remove-link">
                    {% trans "Remove link" %}
                </button>
                </div>
                {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}

      </table>

      <hr>
      <table>
        <tr>
          <th><br></th>
          <td>
              <button type="submit" class="button-big">{% trans "Save changes" %}</button>
          </td>
        </tr>
      </table>


    </form>
</div>


{% addtoblock "js" %}
    <script type="text/javascript" src="{% url "calendar:javascript-catalog" %}"></script>
    <script type="text/javascript" src="{% static 'calendar/js/create_event.js' %}"></script>
{% endaddtoblock %}

{% endblock %}
