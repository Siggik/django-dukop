{% load i18n sekizai_tags static %}
{% load calendar_tags sorl_thumbnail %}
{% load l10n %}

  <div class="card__layout {% if not event_truncate %} card__layout--full {% endif %} {% if event.is_cancelled %}card__cancelled{% endif %}">
    <div class="card__media">
        {% if event_truncate %}
        {% with event.images.first as feature_image %}
            {% if feature_image.image %}
                {% thumbnail feature_image.image "400x250" crop="center" as event_thumbnail %}
                    <img src="{{ event_thumbnail.url }}" alt="{{ event.name }}">
                {% endthumbnail %}
            {% endif %}
        {% endwith %}
        {% else %}
            {% for image in event.images.all %}
                <a href="{{ image.image.url }}">
                {% thumbnail image.image "400" as event_thumbnail %}
                    <img src="{{ event_thumbnail.url }}" alt="{{ event.name }}">
                {% endthumbnail %}
                </a>
            {% endfor %}
        {% endif %}

        {% if not event_hide_share %}
        <div class="card__sharing">
            <h5>{% trans "Share this event" %}</h5>
            <p><a href="{% url "calendar:feed_event_ical" event_id=event.id %}" title="{% trans "Download the .ICS file and open it in a calendar. Alternatively, attach it to an email and people will automatically see the event when they receive the email and be able to add it to their calendar." %}">{% trans "Import to calendar (download .ics file)" %}</a></p>
            <p>
              {% trans "Copy sharing direct URL" %}
              <br>
              <input type="text" value="{{ event.share_link }}" class="share-text-input">
              <button class="js-copy" title="{% trans "Copy url to clipboard" %}"><div class="icon icon__copy"></div></button>
            </p>
            {% if event.links.all %}
                <h5>{% trans "More information" %}</h5>
                {% for link in event.links.all %}
                <p><a href="{{ link.link }}" target="_blank">{{ link.link|url_alias }}</a></p>
                {% endfor %}
            {% endif %}
        </div>

        {% endif %}
    </div>

    <div class="card__text{% if event_truncate %} card__text__truncate{% endif %}">
        <div class="card__header">
          <div class="card__date">
            {% with event_time|default:event.times.future.first as next_occurrence %}
                {% if next_occurrence.start %}
                    {{ next_occurrence.start|dukop_interval:next_occurrence.end }}
                {% else %}
                    {% with event.times.last as last_occurrence %}
                        {% if last_occurrence.start %}
                            {{ last_occurrence.start|dukop_interval:last_occurrence.end }}
                        {% else %}
                            <em class="muted">{% trans "No scheduled times" %}</em>
                        {% endif %}
                    {% endwith %}
                {% endif %}
            {% endwith %}
            <br>
            {% if event.recurrences %}
            {% for recurrence in event.recurrences.all %}
                <span class="muted">{% trans "Recurring" %} {{ recurrence.recurrence_name }}</span>
            {% if not forloop.last %}<br>{% endif %}
            {% endfor %}
            {% endif %}
          </div>
          <div class="card__place card__link">
            {% if event.host %}
                <a href="{% url "calendar:group_detail" pk=event.host.pk %}">{{ event.host }}</a>
            {% endif %}
          </div>
        </div>

        <h1 class="card__title">
          {{ event.name }}
          {% if event.is_cancelled %}
            <span class="badge-error">{% trans "cancelled" %}</span>
          {% endif %}
        </h1>

        {% if not event_truncate %}

            {% with selected_time.description|default:event.description as description %}
              {% if description %}
                  {{ description|linebreaks }}
              {% else %}
                  {{ event.short_description|default:_("The event has no description")|linebreaks }}
              {% endif %}
            {% endwith %}


            {% with event.times.future as future_times %}
            {% if event.recurrences.all or future_times.count != 1 %}
            <h2>{% trans "Upcoming dates" %}</h2>

            <ul>
            {% for time in future_times|slice:10 %}
                {% if time.start %}
                <li><a href="{% url "calendar:event_detail" pk=event.pk time_pk=time.pk %}">{{ time.start|dukop_interval:time.end }}</a></li>
                {% endif %}
            {% empty %}
                <li><em>{% trans "No upcoming times" %}</em>
            {% endfor %}
            </ul>

            {% endif %}
            {% endwith %}

            <h2>{% trans "Location" %}</h2>

            {% if event.online %}
            <p><span class="icon icon__monitor"></span> {% trans "This event is happening online." %}</p>
            {% endif %}

            {% if event.location %}
              <a href="{% url "calendar:location_detail" pk=event.location.pk %}">
                <strong>{{ event.location.name }}</strong><br>
              </a>
              {% if event.street or event.zip_code or event.city %}
              {{ event.street|default:_("Unknown address") }}<br>
              {{ event.zip_code }} {{ event.city|default:_("City not specified") }}
              {% endif %}

            {% elif event.location_tba %}
              <p>{% trans "To Be Announced: The location's location will be announced later." %}</p>

            {% elif event.venue_name %}
              <strong>{{ event.venue_name }}</strong><br>
              {{ event.street }}<br>
              {{ event.zip_code }} {{ event.city }}
            {% else %}
              <p>{% trans "Location not specified." %}</p>
            {% endif %}

            {% if event.online %}
              <p>{% trans "This is an online event." %}</p>
            {% endif %}

        {% else %}
        <div class="card__more__cut">
            {{ event|event_description:100 }}
        </div>
        {% endif %}



        {% if show_user_panel and event|event_can_edit:request.user %}
          <h2>{% trans "Event actions" %}</h2>
          {% include "calendar/includes/event_owner_buttons.html" %}
        {% endif %}

    </div>

  </div>
