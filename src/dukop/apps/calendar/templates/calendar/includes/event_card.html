{% load i18n sekizai_tags static %}
{% load calendar_tags sorl_thumbnail %}
{% load l10n %}

  <div class="card__layout {% if not event_truncate %} card__layout--full {% endif %}">
    <div class="card__media">
        {% with event.images.first as feature_image %}
            {% if feature_image.image %}
                {% if event_truncate %}
                    {% thumbnail feature_image.image "400x250" crop="center" as event_thumbnail %}
                        <img src="{{ event_thumbnail.url }}" alt="{{ event.name }}">
                    {% endthumbnail %}
                {% else %}
                    <a href="{{ feature_image.image.url }}">
                    {% thumbnail feature_image.image "400" as event_thumbnail %}
                        <img src="{{ event_thumbnail.url }}" alt="{{ event.name }}">
                    {% endthumbnail %}
                    </a>
                {% endif %}
            {% endif %}
        {% endwith %}
        {% if not event_hide_share %}
        <div class="card__sharing">
            <h5>{% trans "Sharing" %}</h5>
            {% if not event_truncate %}
            <a href="">Download til kalender (ICS)</a>
          {% endif %}
            <p>
            <a href="{{ event.share_link }}">
                {% trans "Share link" %}
            </a><br>
            <input type="text" value="{{ event.share_link }}" class="share-text-input">
            <button class="js-copy">{% trans "Copy url to clipboard" %}</button>
            </p>
        </div>
        
        {% endif %}
    </div>

    <div class="card__text">
        <div class="card__header">
          <div class="card__date">
            {% for time in event.times.future|slice:10 %}
                {% if time.start %}
                {{ time.start|dukop_interval:time.end }}
                {% else %}
                -
                {% endif %}
                {% if not forloop.last %}<br>{% endif %}
            {% empty %}
                {% for time in event.times.all %}
                    {% if time.start %}
                    {{ time.start|dukop_interval:time.end }}
                    {% else %}
                    -
                    {% endif %}
                {% empty %}
                    {% trans "No scheduled times" %}
                {% endfor %}
            {% endfor %}
          </div>
          <div class="card__place card__link">
            <a href="">{{ event.venue_name }}</a>
          </div>
        </div>

        <h1 class="card__title">{{ event.name }}</h1>

        {% if not event_truncate %}
            {% if event.description %}
            {{ event.description|linebreaks }}
            {% else %}
            {{ event.short_description|linebreaks }}
            {% endif %}

            {% if event.links.all %}
                <h5>{% trans "Event links" %}</h5>
                {% for link in event.links.all %}
                <p><a href="{{ link.link }}" target="_blank">{{ link.link|url_alias }}</a></p>
                {% endfor %}
            {% endif %}

        {% else %}
        <div class="card__more__cut">
        {{ event_time.event.short_description|truncatechars:100 }}
        </div>
        <div class="card__more">
            {% if event.description %}
            {{ event.description|truncatewords:event_truncate|linebreaks }}
            {% else %}
            {{ event.short_description|truncatewords:event_truncate|linebreaks }}
            {% endif %}
            <p>
                <a href="{% url "calendar:event_detail" pk=event_time.event.pk slug=event_time.event.slug %}">
                    {% trans "Event detail page" %}
                </a>
            </p>
        </div>
        {% endif %}

        

        {% if show_user_panel and event|event_can_edit:request.user %}
            <ul class="button-menu">
                <li><a href="{% url "calendar:event_update" pk=event.pk %}" title="Edit" class="button">{% trans "Update" %} <div class="icon icon__tool"></div></a></li>
                <li><a href="" title="Cancel" class="button">{% trans "Cancel" %} <div class="icon icon__cancel"></div></a></li>
                <li><a href="" title="Delete" class="button">{% trans "Delete" %} <div class="icon icon__delete"></div></a></li>
            </ul>
        {% endif %}

    </div>

  </div>
