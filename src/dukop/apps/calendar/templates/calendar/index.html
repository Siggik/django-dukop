{% extends "base.html" %}
{% load calendar_tags sorl_thumbnail %}

{% block content_wrapper %}

{% get_event_times max_count=20 as event_times %}

{% for event_time in event_times %}
<div class="card">
  <div class="card__layout">
    <div class="card__media">
        {% with event_time.event.images.first as feature_image %}
            {% if feature_image.image %}
                {% thumbnail feature_image.image "400x250" crop="center" as event_thumbnail %}
                    <img src="{{ event_thumbnail.url }}" alt="{{ event_time.event.name }}">
                {% endthumbnail %}
            {% endif %}
        {% endwith %}
    </div>
    <div class="card__text">
      <div class="card__header">
        <div class="card__date">
          {{ event_time.start }}
        </div>
        <div class="card__place card__link">
          <a href="/locations/109?locale=da">{{ event_time.event.venue_name }}</a>
        </div>
        <div class="card__util card__link card__more">
          <a href="/events/5276.ics?locale=da">Download til kalender (ICS)</a>
        </div>
      </div>
      <div class="card__main">
        <h1 class="card__title">
          {{ event_time.event.name }}
        </h1>
        {{ event_time.event.short_description|truncatechars:100 }}
        <div class="card__more">
          {{ event_time.event.short_description|linebreaks }}
        </div>
      </div>
    </div>
  </div>
  <a class="card__toggle js-toggle-card" href="/events/5276?locale=da"></a>
</div>

{% endfor %}

<div class="page-container">
  <h1 class="title title--space">Det sker <span class="title__bold">også i dag </span></h1>
  <div class="timeline">
    <div class="timeline__event timeline__event--color3 timeline__event--right" data-text="Yoga med Natalie"
      style="width: 17.812499999999996%; margin-left: 13.437500000000002%">
    </div>
    <div class="timeline__event timeline__event--color1 " data-text="Biograf i Folkets Hus kl 16.00"
      style="width: 18.75%; margin-left: 50.0%">
      Biograf i Folkets Hus ...
    </div>
    <div class="timeline__event timeline__event--color1 " data-text="Bogcaféen Barrikaden + Distro 61"
      style="width: 18.75%; margin-left: 50.0%">
      Bogcaféen Barrikaden +...
    </div>
    <div class="timeline__event timeline__event--color3  timeline__event--left" data-text="Yin Flow Yoga"
      style="width: 8.125000000000004%; margin-left: 56.25%">
    </div>
    <div class="timeline__event timeline__event--color3  timeline__event--left" data-text="Taekwondo"
      style="width: 7.187499999999991%; margin-left: 64.375%">
    </div>
    <div class="timeline__event timeline__event--color2  timeline__event--left" data-text="Mandagsmøde"
      style="width: 12.5%; margin-left: 68.75%">
    </div>
    <div class="timeline__event timeline__event--color1  timeline__event--left" data-text="Tai chi og Qi Gong med Bo "
      style="width: 12.5%; margin-left: 75.0%">
    </div>
    <div class="timeline__event timeline__event--color3 timeline__event--right" data-text="Tai Chi med Viggo "
      style="width: 9.062499999999996%; margin-left: 12.5%">
    </div>
    <div class="timeline__event timeline__event--color3 timeline__event--right" data-text="Pop-up legestue for børn"
      style="width: 12.5%; margin-left: 43.75%">
    </div>
    <div class="timeline__event timeline__event--color3  timeline__event--left" data-text="Vinjasa yoga med Pernille "
      style="width: 6.25%; margin-left: 59.06249999999999%">
    </div>
    <div class="timeline__event timeline__event--color2  timeline__event--left" data-text="Yoga and Dance"
      style="width: 18.75%; margin-left: 68.75%">
    </div>
    <div class="timeline__event timeline__event--color2  timeline__event--left"
      data-text="Feministisk lige uger / LGBT selvforsvar ulige uger"
      style="width: 8.125000000000004%; margin-left: 68.75%">
    </div>
    <div class="timeline__event timeline__event--color2  timeline__event--left" data-text="Free style drum jam med dans"
      style="width: 4.374999999999996%; margin-left: 89.375%">
    </div>
    <div class="timeline__event timeline__event--color3 timeline__event--right" data-text="Yoga med Fanny"
      style="width: 10.625000000000002%; margin-left: -4.375000000000001%">
    </div>
    <div class="timeline__event timeline__event--color3 timeline__event--right" data-text="Tai chi og Qi Gong med Bo"
      style="width: 12.5%; margin-left: 6.25%">
    </div>
    <div class="timeline__event timeline__event--color1  timeline__event--left" data-text="Yin yoga med Laura"
      style="width: 7.187499999999991%; margin-left: 56.25%">
    </div>
    <div class="timeline__event timeline__event--color1 " data-text="BumZen Community Kitchen"
      style="width: 25.0%; margin-left: 62.5%">
      BumZen Community Kitchen
    </div>
    <div class="timeline__event timeline__event--color3  timeline__event--left" data-text="AFROFONKO"
      style="width: 12.5%; margin-left: 64.375%">
    </div>
    <div class="timeline__event timeline__event--color2 " data-text="Små stjerner (forældrebørnehave)"
      style="width: 37.5%; margin-left: 12.5%">
      Små stjerner (forældre...
    </div>
    <div class="timeline__event timeline__event--color2  timeline__event--left" data-text="Yoga med Ida"
      style="width: 10.624999999999996%; margin-left: 51.87500000000001%">
    </div>
    <div class="timeline__event timeline__event--color1 " data-text="Bogcaféen Barrikaden + Distro 61"
      style="width: 25.0%; margin-left: 56.25%">
      Bogcaféen Barrikaden +...
    </div>
    <div class="timeline__event timeline__event--color3  timeline__event--left" data-text="Folkekøkken"
      style="width: 12.5%; margin-left: 68.75%">
    </div>
    <div class="timeline__event timeline__event--color1  timeline__event--left" data-text="Slow-Jam folkedans musik"
      style="width: 12.5%; margin-left: 75.0%">
    </div>
    <div class="timeline__event timeline__event--color3 timeline__event--right" data-text="Tai Chi og Qi Gong med Bo"
      style="width: 10.624999999999996%; margin-left: 1.8750000000000044%">
    </div>
    <div class="timeline__scale">
      <div class="timeline__min">
        08:00
      </div>
      <div class="timeline__max">
        24:00
      </div>
      <div class="timeline__now" id="timeline__now"></div>
    </div>
  </div>

</div>


{% get_event_times days=31 as event_times %}

<div class="page-container">
  <div class="table">

  {% for event_time in event_times %}

    <div class="table__day">
      {% ifchanged event_time.start.date %}
      <div class="table__header">
        {{ event_time.start.date|date }}
      </div>
      {% endifchanged %}

      <a href="/events/5276?locale=da" class="table__event">
        <div class="table__time">
          {{ event_time.start.time|time }}
        </div>
        <div class="table__title">
          {{ event_time.event.name }}
        </div>
        <div class="table__place">
          {{ event_time.event.venue_name }}
        </div>
      </a>
    </div>
  {% endfor %}


  </div>
</div>
<div class="overlay" id="js-overlay"></div>

<script>
  function closeAll() {
    document.getElementById('js-overlay').classList.remove('js-active');
    document.getElementById('js-lock-body').classList.remove('js-active');
    var allActive = document.getElementsByClassName('js-active');

    Array.prototype.forEach.call(allActive, function (el) {
      el.classList.remove('js-active');
    });
  }

  function ready(event) {
    function addEventListenerList(list, event, fn) {
      for (var i = 0, len = list.length; i < len; i++) {
        list[i].addEventListener(event, fn, false);
      }
    }

    function toggleActive() {
      var dataElement = this.dataset.element;
      var group = document.getElementsByClassName(this.dataset.group);
      var element = document.getElementById(dataElement);
      element.classList.toggle('js-active');
    }

    function toggleCard(event) {
      event.preventDefault();
      this.parentNode.classList.toggle('js-active')
      document.getElementById('js-overlay').classList.toggle('js-active');
      document.getElementById('js-lock-body').classList.toggle('js-active');
    }

    function toggleBurger() {
      var controls = document.getElementById('js-controls');
      controls.classList.toggle('js-active');
    }

    var listJsToggle = document.getElementsByClassName('js-toggle');
    addEventListenerList(listJsToggle, 'click', toggleActive);

    var listJsToggleCard = document.getElementsByClassName('js-toggle-card');
    addEventListenerList(listJsToggleCard, 'click', toggleCard);

    var now = new Date;
    var nowElement = document.getElementById('timeline__now');
    var timeAsNumber = now.getHours() + (now.getMinutes() / 60)
    nowElement.style.marginLeft = (timeAsNumber - 8) * 6.25 + '%'
    // clean up event binding
    window.removeEventListener('DOMContentLoaded', ready);
  }
  // bind to the load event
  window.addEventListener('DOMContentLoaded', ready);

  document.onkeydown = function (evt) {
    evt = evt || window.event;
    var isEscape = false;
    if ("key" in evt) {
      isEscape = (evt.key == "Escape" || evt.key == "Esc");
    } else {
      isEscape = (evt.keyCode == 27);
    }
    if (isEscape) {
      closeAll()
    }
  };
</script>

{% endblock %}
